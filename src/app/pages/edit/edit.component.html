<div class="wrapper">
  <h1>Edition du profil</h1>
  @if ((user$ | async); as user) {
  <div class="avatars-box">
    <div class="avatar-box">
      @if (user.photoURL) {
      <img [src]="user.photoURL" alt="old profile pic" />
      } @else {
      <div class="container-initials">
        {{ util.generateNameInitials(user.displayName!) }}
      </div>
      }
      <div class="avatar-option" (click)="toggleAvatarOptions()">
        <ion-icon name="camera-outline"></ion-icon>
      </div>
      @if (_isAvatarOptionsDisplayed) {
      <div class="avatar-options">
        <div class="option">
          <label for="avatar">
            <ion-icon name="folder-outline"></ion-icon>
            <span> {{ "pages.edition.selectImage" | translate }} </span>
          </label>
          <input
            type="file"
            id="avatar"
            (change)="onAvatarChange()"
            (cancel)="toggleAvatarOptions()"
            hidden
            accept="image/*"
          />
        </div>
        @if (!_newAvatarFile && user.photoURL) {
        <div class="option" (click)="deleteUserAvatar()">
          <ion-icon name="trash-bin-outline"></ion-icon>
          <span> {{ "pages.edition.deleteImage" | translate }} </span>
        </div>
        }
      </div>
      }
    </div>

    @if (_newAvatarFile) {
    <ion-icon class="next-arrow" name="chevron-forward-outline"></ion-icon>

    <div class="avatar-box">
      <img [src]="generateAvatarUrl(_newAvatarFile)" alt="new profile pic" />
      @if (_isAvatarUploading) {
      <div class="avatar-option center">
        <div class="spinner"></div>
      </div>
      } @else {
      <div class="avatar-option cancel" (click)="dismissNewAvatar()">
        <ion-icon name="close-outline"></ion-icon>
      </div>
      <div class="avatar-option left validate" (click)="validateNewAvatar()">
        <ion-icon name="checkmark-outline"></ion-icon>
      </div>
      }
    </div>
    }
  </div>
  } @if (_editForm) {
  <form [formGroup]="_editForm" (submit)="onSaveData()">
    <label for="username">Username</label>
    <input id="username" type="text" formControlName="username" />
    <label for="animeGenres">Genres</label>
    <span>favoris</span>
    <div class="animes-genres">
      @for (genre of _userData.favoriteGenres; track $index) {
      <div class="anime-genre favorite">
        {{ genre }} <ion-icon name="arrow-down-circle-sharp"></ion-icon>
      </div>
      }
    </div>

    <span>suggérés</span>
    <div class="animes-genres">
      @for (genre of _genreSuggestions; track $index) {
      <div class="anime-genre">
        {{ genre.name }} <ion-icon name="arrow-up-circle-sharp"></ion-icon>
      </div>
      }
    </div>

    <div class="actions">
      <a onclick="" routerLink="/account">Retour</a>
      <button type="submit">
        @if (_isSavingData) {
        <div class="spinner"></div>
        } @else { Sauvegarder }
      </button>
    </div>
  </form>
  }
</div>
